# 业务开发设计心得

## 为什么需要设计文档
在日常的研发工作中，需求或大或小。当需求简单时，我们可能只需要修改一处文案、一点字体样式；而当需求庞大时，我们则可能要面对一个原本复杂模块的改版与重构，或者是从零开始搭建一个未知的项目。前者有时只需要不到10分钟，后者则可能耗费一整个月
如果一切的需求都只是小修小补，那么我们以直觉进行开发也无可厚非。然而当面对真正复杂的需求时，直觉很可能会失效，甚至有些复杂的需求会隐藏在产品并未完善的文档中，我们可能会以为它很简单，直到加班与延期的来临，我们才可能真正看清它们的本来面目

保险起见，我们需要在开发之前对接下来的工作有所明确，于是我们有了前端设计环节
然而，在我们现有的产研流程中，已经包含了前端设计这个环节。那么什么时候需要设计？什么时候不需要？设计时粒度需要明细到什么程度？这些问题，不同的人可能有不同的见解，在此提出我自己的心得，抛砖引玉，交流分享

## 日常需求设计流程
编写设计文档可以理解为一个 “翻译” 的过程，它的 “输入(Input)” 是产品的需求，而 “输出(Output)” 的内部是明确我们即将进行开发的方向，对外则以任务的拆分与排期得以体现。也就是说，我们需要把产品需求里的 “业务语言” 翻译成 “开发语言”。
或者用我们研发岗位更熟悉的词：编译
编译原理的核心内容包括以下几个方面：—— 通义千问
1. 词法分析 (Lexical Analysis)：这是编译的第一个阶段，编译器读取源程序的字符流，并将其分组成具有语义的单元，称为记号（tokens）。例如，标识符、关键字、运算符、常量、注释等都是记号的例子。在这个过程中，编译器还会忽略无关紧要的字符，比如空格和换行符。
2. 语法分析 (Syntax Analysis)：在词法分析之后，编译器会根据语言的语法规则（通常是上下文无关文法）来检查这些记号是否构成合法的语法结构。如果语法正确，那么它们会被组织成一种树状的数据结构，通常称为抽象语法树（AST, Abstract Syntax Tree）。
3. 语义分析 (Semantic Analysis)：在此阶段，编译器会对抽象语法树进行进一步的检查，以确保所有的语义规则都被遵循。例如，变量是否被声明、类型是否匹配等。此外，语义分析还可能涉及到一些优化操作。
4. 中间代码生成 (Intermediate Code Generation)：为了简化后续的处理，编译器可能会生成一种中间表示形式的代码。这种代码既不是源语言也不是目标机器的代码，而是一种更易于理解和优化的形式。
后续还包含 优化、代码生成、符号表管理、错误处理 等

## 第一步：从产品的需求中整理出需求列表
这是最开始的梳理工作。我们只有明确了工作量，明确了任务的边界，证明自己对当前版本即将开展的工作真的已经了然于胸，才有底气真正开始后续的设计与开发。同时也方便在内部评审中，向不了解版本的其他同事简要概括版本需求
就像 词法分析 (Lexical Analysis) 一样，我们需要把和前端工作有关的任务点提取出来，并列举需求文档中提到的细节要求
当产品和项目比较熟悉的时候，关注需求里提到和页面有关的部分，比如入口携带的参数，交互效果，界面显示条件等一些关键字信息；当将要负责自己不熟悉的项目版本时，请有疑问时多与版本内的其他参与者（产品、后端、测试等）以及组长或项目负责人同步信息，明确版本内前端需要负责的工作

如果需求列表梳理不到位，可能会造成功能遗漏，或者后续设计出现错位缺陷（当然直到测试开始用例评审，都还有机会补充，可以祈祷没有错过太多）
【需求列表】示例：

- 需求A（YY签署增加NN信息）：
  - 进入YY页面时NN信息在满足条件下，展示AA选项，非必填

- 需求B（XX导航）：
  - 隐藏XX按钮
  - 查询新的XX信息并 toast 展示
  - XX显示按产品需求规则输出特定文案
  - XX列表【RR】标签
    - 按条件展示/隐藏（条件很可能是交由后台判断的，前端需要进行的工作应该只有1.查询条件，2.使用条件进行判断展示）
  - 新增XX页面
  
## 第二步：开始具体分析需求列表中的每项任务
前端大部分的业务都是基于浏览器显示的页面进行开发，从进入页面、进行交互、提交信息、跳转离开的流程，完成一个又一个的业务场景闭环。所以我们可以基于页面进行模块的划分，常用的方式是把需求会涉及到的项目、项目中的页面罗列出来，并开始分析：项目现状如何，版本需求所造成的改动有多大
在这个环节，我们将如同 语法分析 (Syntax Analysis) 一般，梳理出需求和项目的上下文关系，形成该版本特有的树状结构。这些树是基于版本会产生影响的页面作为根模块(Root)进行呈现的，具体的业务场景下的代码工作，将成为这些树的 叶子节点(Leaf)，我们也得以粗略对现状进行评估，例如：
1. 需要修改的节点所需的数据是否充分，信息以什么途径流转？链接？状态管理？还是缓存？它的父节点是什么；
2. 类似的模块是否需要整合，也许其中一方已经过于繁杂，强行整合可能会产生大量的重构工作；
3. 需求是否有不完善的地方？后端提供的借口是否缺少完成业务闭环的参数
使用页面作为根模块(Root)的原因：
不论是对于QA测试，还是对于生产环境的用户，前端工作的验证都是基于页面开始的，不管是界面是否正确呈现，或是操作与交互是否提供反馈，还是接口是否顺利提交，以及流程是否正确跳转，一切前端业务的入口，都是在某个链接跳转后，进入一个特定的页面开始

【需求分析】场景示例：
- 版本需求A：
  - 版本涉及的页面A1
    - 新增初始化配置查询
    - 按配置结果展示新的界面
    - 提交接口补充新参数
  - 版本涉及的页面A2
    - 与A1新增的界面共用同一个模板
- 版本需求B
  - 版本涉及的页面B1
    - 与A1页面查询相同的初始化配置

## 第三步：初步评估工作量
此时，基于初步分析过的版本任务，设计者可以开始对版本内的任务进行简单的评估，此时工作量基本会按以下等级呈现
### **第0级** 😎不需要开发（节省工作）
- 经过梳理后，发现需求已经实现/现有代码可以满足，不需要前端参与的情景

### **第1级** 🤗凭直觉就可以完成的简单开发（半小时以内的增删改查）
- 基础页面元素的增删改查，例如：增加一个按钮、删除列表项、修改颜色、链接/提交接口补充参数等

建议：在完全确认的情况下，可以不对这类需求进行进一步的梳理  
注意：如果一个版本的前端工作都是此类需求，开发+联调的排期可能不会超过3天

### **第2级** 🧐影响面/复杂度其中一项较可控的中等工作（半天以内的模块开发）
- 复杂的UI界面 + 简单的交互 + 少量接口
- 可用组件库快速实现的交互 + 中等程度的数据整理 + 少量接口提交
- 已有模块的特定组件待提交接口的数据整理
- 使用项目模板对新项目进行“开荒”，配置 store、axios，安装 common-js 依赖，并进行基础调试等
1. 至少以文字列表的形式对任务所需的工作内容进行列举
2. 当时间紧张或个人对项目、业务较为熟悉时，可自行判断是否输出详细的设计

### **第3级** 🤔界面交互复杂/业务流程长的进阶工作（1~2天的复杂组件页面）
- 同一个业务流程下多个系列页面的数据、UI界面调整
- 新增/修改复杂的页面UI，同时针对不同的显示界面进行初始化数据整理、状态切换
- 复杂交互修改，同时需要针对待提交的模板进行数据整理
- 产品需求点较小，但是影响面较复杂，在时间充足的情况下，可能需要进行小范围的重构
1. UI 的界面图可能会花费超出预期的时间，请谨慎对待样式开发
2. 建议这个程度的需求开始梳理具体的影响面与输出详细的设计方案，例如绘制思维导图
3. 如果是针对现存代码的修改，需要输出与原流程的对比
4. 如果要尝试未使用过的设计模式，建议在设计时提供该模式结合项目业务组件的伪代码

### **第4级** 😥影响面/复杂度高/长流程的多模块开发（4天以上）
- 通常是产品新增加的一个需求下的系列页面，包含多个路由、多个项目（前端与后台管理等）
- 产品决定合并已有模块，需要将多个组件修改为适配多种流程的新组件，同时可能需要在保证某一条流程不受影响时
1. 可以理解为新业务线开发 or “改版”
2. 务必对具体工作进行进一步拆分，梳理出需要完成的路由页面制作与修改
3. 当具体页面/组件模块具备相当复杂程度时，需要再进一步针对该部分做更详细的设计
4. 如果需求量较大，可先输出包含影响模块的初稿后，申请延长设计时间

### **特殊情况1** 🚀尚不明确可行性的需求（调研后评估）
- 组件库无法简单实现，同时个人历史经验无法快速得出具体实践方案的交互
1. 第一时间开始预研 + 实验，最好在设计的第一天内完成 demo，并附上可参考的代码或伪代码
2. 超过半个工作日，仍然对实现方案毫无进展时，尽快向其他同事寻求协助

### **特殊情况2** 😵明确无法实现（尽快沟通）
- 将无法实现的需求梳理后向产品反馈，删减、调整需求

**第3级**、**第4级** 的工作，需要将其拆分至 **第1级**、**第2级**的程度。但是一项任务是否属于足够可控的中等工作，也需要开发者对自己的个人能力以及项目的了解程度具备了足够的认知才能做出判断
## 第四步：影响面分析与流程
当需求较复杂，或者对影响面无法确认时，可以将梳理的过程逐个记录，并从中找到与版本需求合适的切入点
个人通常会使用思维导图，分别梳理不同模块，或是针对特定流程的影响面进行梳理
例如梳理某个状态管理与控制器操作下的模块：
<img width="2008" height="726" alt="image" src="https://github.com/user-attachments/assets/ddb93519-5768-48b9-af11-9992e1dab220" />

针对具体页面流程的梳理：
特定流程页可以分为初始化、交互、完成3个部分
<img width="2334" height="1088" alt="image" src="https://github.com/user-attachments/assets/4df93d74-abad-4e79-8e88-6540c13facf9" />


1. 初始化（获取数据 -> 整理数据 -> 绘制页面）
通常是页面进入需要完成的一些查询操作，可能查询接口会需要处理先后顺序，并将最终的结果呈现到模板上进行显示
2. 交互（声明回调函数 -> 绑定回调函数 -> 修改页面）
当用户执行某个操作时，我们需要为用户准备的事件处理逻辑，以及这个操作所对应的交互变化
3. 完成（整理数据 -> 提交接口 -> 离开页面）
用户在执行需要离开页面的操作时，我们需要完成接口的提交，需要缓存的 store 处理等等，总之是这个流程即将结束的生命周期里，为实现业务闭环所需的工作


复杂的业务流程可在这个环境进行拆分，文档中需要输出和体现：
1. 版本开发者对需求的影响面有了足够的认知
2. 版本开发者对需求所需的工作量具备了足够的认知
## 第五步：输出排期
当版本任务的粒度梳理得足够清晰时，确保自己有把握每项排期的开发任务工时最多不超过 0.5 工作日。
- 排期可以按照以下格式录入任务
  - {页面}-{模块}-{事项}
- 如果是系列流程的多个页面任务，可以录入
  - {流程}-{页面}-{模块}-{事项}
- 如果没有具体的模块，可以省略{模块}项
- 当单一模块、事项较轻松时，可以拼接任务名
  - {页面1、页面2}-{模块}-{事项1、事项2}
  - {页面}-{模块1}-{事项1}；{模块1}-{事项2}
### 确认接口联调时间
当我们进行接口联调时，需要完成哪些工作？我们可以基于后端输出的接口数量，并针对每一个接口更新后，有待前端界面进行验证的任务进行梳理
参考：AI v1.5.0 推荐问题-专家审核标识 前端设计
### 后端开发当前的设计进展
#### 后端未完成接口设计（前端设计先于后端完成）
在前端设计的过程中，自行梳理实现需求所需的接口调整，并主动与后端沟通，协调接口设计
#### 后端已完成设计评审（前端设计尚未完成）
在完成开发任务的排期输出后，使用后端提供的设计文档进行查漏补缺。如果发现后端设计接口与交互需求不匹配，则向后端提出修改意见，例如增加接口、补充字段等
## 意外情况预防
- 前端设计启动时间较晚，测试已开始催促输出排期与提测时间
  - 至少花费1天时间进行基础的需求梳理工作，从早上收到催促后，尽量避免其他事项打扰
  - 设计中减少非必要工作，例如重构、新技术栈尝试、新设计模式尝试，以效率优先
  - 如果版本工作量存在可以预期的巨大不确定性（影响页面数量超过8~10个、需求无法通过项目现有功能实现），尽快在设计方案中明确，并在下午向上提出反馈
  - 当天仍然收到其他高优先级事项占用工作时间（例如线上问题排查解决），申请延期或修改版本负责人
- 排期时间可进行适当修改，为尚不明确的后续开发、突发情况留有缓冲余量
- 排期时间需要考虑可以预见的会议对工作时间的占用
- 完成前端设计、排期时，UI稿尚未输出，可在版本排期中额外录入 UI 调整任务
- 后端设计存在缺陷，接口结构可能发生调整
  - 如果代码方案足够灵活，联调时间也较为充足，可以尽快配合调整
  - 配合调整的时间需要控制（尽量控制在0.5天内？），调整量较大需要向上反馈并考虑延期
- 后端设计并不完整，并未涉及版本需求涵盖的全部影响面，通常发生在 “改版” 类版本中
  - 尽快向上反馈，延期可能不可避免
  - 设计阶段尽可能将需求的影响面梳理完整，为后续协调（分锅）争取话语权

1. 请尽量确保前端设计足够完善与充足，可以尽早发现产品需求与后端接口的缺陷
2. 设计或开发的过程中，当产品、后端需要进行相应的调整，请确保在版本群内对话中有记录、留痕


## 如何检验设计是否有效
设计是一个 “编译” 的过程，输入的是产品的需求，输出则包含
1. 开发者对需求完整落地所需工作的理解体现
2. 开发者对需求实现时间的规划
那么针对这两项的验证，则可从以下两方面进行检验
1. 版本bug率，体现设计的周密与闭环程度
2. 版本加班情况，体现设计对个人工作规划的合理性
当以上方面出现较大偏差时，可由版本负责人在提测后/发版后提出复盘会议，对当前版本暴露的问题进行讨论

一切的方法论都是在做模块拆分
